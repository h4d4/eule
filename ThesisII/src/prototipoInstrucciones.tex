\label{ch:anexos}
\chapter{Anexos}
\section{Instrucciones para probar del prototipo}
En el directorio \small{\ttfamily{/home/testing/eule}} están los elementos
necesarios para evaluar los casos de prueba, de allí interesan los
subdirectorios \small{\ttfamily{androidFlows}},
\small{\ttfamily{InputLabelGenerator}} y el jar
\small{\ttfamily{LabelGenerator.jar}}.

El subdirectorio \small{\ttfamily{androidFlows}} contiene la estructura de
archivos necesaria para ejecutar un programa jif, así:
\small{\ttfamily{sig-src}} aloja clases java y clases de la API de Android, con
signaturas para que jif las reconozca de forma nativa.
\small{\ttfamily{jif-src/test}} tiene clases de la API de Android con
anotaciones jif(Activity.jif, BroadcastReceiver.jif, Log.jif, R.jif,
Service.jif, SmsManager.jif). Allí se deben alojar los programas jif a
ejecutar.\newline 
En {\small{\ttfamily{InputLabelGenerator}}} están los fuentes java a pasar como
entrada para el generador de labels(LabelGenerator.jar), que devuleve la
versión jif de los mismos. Se recomienda utilizar estos, ya que contienen las
adaptaciones necesarias para poder ser analizadas con JIF, la adición de
excepciones NullPointerException, ClassCastException y
ArrayIndexOutOfBoundsException, son algunos ejemplos de elementos adicionados.

 \textbf{Instrucciones de
ejecución:}\newline \textbf{(1)} Ejecutar el jar para la generación de los labels:
\begin{lstlisting}
testing@debianJessie:~/eule$ java -jar LabelGenerator.jar
\end{lstlisting}
Una vez se ejecuta el .jar, se solicita el directorio de entrada(que contiene
las aplicaciones a anotar) y el directorio de salida(para alojar las
aplicaciones anotadas). Separados por el simbolo @
\begin{lstlisting}
Ingrese la ruta completa para el directorio de entrada, y para el 
directorio de salida:
Ejemplo: dir-entrada@dir-salida 
\end{lstlisting}
Se deben pasar los directorios:
\begin{lstlisting}
InputLabelGenerator@androidFlows/jif-src/test/
\end{lstlisting}

\textbf{(2)} ejecutar el script setup.sh(basta con ejecutarlo una sola vez)
\begin{lstlisting}
testing@debianJessie:~/eule/androidFlows$ ./setup.sh
\end{lstlisting}

\textbf{(3)} 
Ejecutar el .jif generado:\newline
En la ruta pasada como directorio de salida en el punto anterior
{\small{\ttfamily{androidFlows/jif-src/test}}}, se genera un subdirectorio por
aplicación, con un .java y un *-out.jif. Se debe ejecutar el *-out.jif. Por
ejemplo, para evaluar el testcase ArraysAndLists\_ArrayAccess1:
\begin{lstlisting}
testing@debianJessie:~/eule/androidFlows$ ./jifc-java-libraries.sh \
jif-src/test/ArraysAndLists_ArrayAccess1/ArrayAccess1-out.jif
\end{lstlisting}
Cuando se presentan flujos indebidos, el compilador genera una salida señalando
los problemas de seguridad.
\lstset{
    language=bash,
    basicstyle=\tiny,
  }
\begin{lstlisting}
estudiante@debianJessie:~/eule/androidFlows$ ./jifc-java-libraries.sh \
jif-src/test/ArraysAndLists_ArrayAccess1/ArrayAccess1-out.jif 
/home/testing/eule/androidFlows/jif-src/test/ArraysAndLists_ArrayAccess1/ArrayAccess1-out.jif:51:
Unsatisfiable constraint
    	general constraint:
    		actual_arg_3 <= formal_arg_3
    	in this context:
    		{Alice->; _<-_ ⊔ caller_pc} <= {}
    	cannot satisfy equation:
    		{Alice->} ⊑ {}
    	in environment:
    		{this} ⊑ {caller_pc}
    		[]

    Label Descriptions
    ------------------
     - actual_arg_3 = the label of the 3rd actual argument
     - actual_arg_3 = {Alice->; _<-_ ⊔ caller_pc}
     - formal_arg_3 = the upper bound of the formal argument text
     - formal_arg_3 = {}
     - caller_pc = The pc at the call site of this method (bounded above by 
    {})
     - this = label of the special variable "this" in test.ArrayAccess1

    The label of the actual argument, actual_arg_3, is more restrictive than 
    the label of the formal argument, formal_arg_3.
            sms.sendTextMessage("+49 1234", null, arrayData[2], null, null);
                                                  ^-------^

1 error.
testing@debianJessie:~/eule/androidFlows$
\end{lstlisting}

Cuando el caso de prueba no presenta flujos indebidos, el compilador no genera
salidas, por ejemplo, al evaluar el testcase AndroidSpecific\_LogNoLeak, el
compilador retorna el prompt de la shell, sin ningún comentario.

\section{Instrucciones para uso de FlowDroid}
En el directorio \small{\ttfamily{/home/estudiante/eule}} también se encuentran
los subdirectorios \small{\ttfamily{/FlowDroid}} y
\small{\ttfamily{/DroidBench-master}} que contienen los elementos necesarios
para probar los testcases con FlowDroid.\newline 
Para ello se requiere ejecutar el jar de FlowDroid, indicando el apk a analizar,
los apk están en el subdirectorio \tetxtit{DroidBench-master}.
Por ejemplo, para analizar el testace ImplicitFlow4:
\begin{lstlisting}
testing@debianJessie:~/eule/FlowDroid$ java -jar FlowDroid.jar \
../DroidBench-master/apk/ImplicitFlows/ImplicitFlow4.apk
/home/estudiante/android-sdks/platforms/
\end{lstlisting}
El archivo \small{\ttfamily{howRunIt}} contenido en el directorio
\small{\ttfamily{/FlowDroid}}, indica como se debe ejecutar.
